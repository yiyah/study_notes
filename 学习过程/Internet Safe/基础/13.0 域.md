# 域

---

[toc]

---

## 一、概念

### 1.1 前言

* 域：Domain，实际上代表一种环境 ，对应的是什么环境呢？内网环境（那内网环境是什么呢？如下：）

* 内网环境，分两种：

    1. 工作组：

        * 默认模式：在内网里，默认是工作组环境。

        * 特点：人人平等， 就是不方便管理（就是在这个环境里，我想控制你，就必须得到你的同意）。

            但是这种不利于企业管理（比如我想修改每台电脑的配置，需要一个个去修改。所以为了方便管理，就有了下面的域环境）

    2. 域

        * 特点：集中管理，统一管理。（人人不平等，但其实成员机还是平等的）

### 1.3 域的组成

1. 域控制器：DC(Domain Controller)（就是老大，可以控制所有人的控制器。也是一台电脑，一般情况下我们称这台设备不是普通电脑了，可能在机房里放着，服务器，我们叫域控服务器）
2. 成员机：域成员（平等的）。

## 二、 域的部署

### 2.1 域基础

本来，一个内网里大家都是在工作组环境。但是有一天，我部署了一台域控制器，于是我这个内网里， 域就出现了。

<img src="https://raw.githubusercontent.com/yiyah/Picture_Material/master/20200415000903.png" style="zoom:50%;" />

内网的其他成员，只有主动加入我这个域，我才能控制。不然的话，没其他办法。只能一个个去加。（所以在公司里是一次性操作，除非公司的网络大规模改动，否则都不用改了。以后有新员工，把他加到这个域里就好了）

当大家都加入公司的域的时候，大家的电脑右键属性不在属于工作组，而是属于域。

那这个域，总得有个域名吧，一般都会以自己的公司名称命名，例如：千峰，就叫 `qf.com`。这时候，这个三角形叫做 `qf.com`。这个三角是域，那么 `qf.com` 就是该域的总称。

这个域的电脑，不再叫你自己电脑的名称了。比如说：DC（域控制器，本身也是一台电脑），假设 DC 创建的计算机名称就叫 DC，但是它不能叫DC了，它叫 `DC.qf.com`。因为它在这个域里。（域里的其他电脑也一样，一般来说，有域的环境，计算机名都是统一的。就是公司不允许你自己命名，公司提前做好了，因为进公司前，公司的网络人员会把你电脑加入域，并且强制改好的你计算机名）

那计算机名是 `xxx.qf.com` 的话，就要域名解析了。所以域和 DNS 是一个完美的搭档。部署域控制器的时候，会提示你必须也得把我部署为一台DNS服务器。（当你给你的域命名的时候，创建完域控制器，DNS装好了。DNS会默认创建好一个以你给域命名的区域文件，还有一个A记录，是域控制器的解析记录）

所以，加入这个域的成员，都不能指向网络上的DNS，必须指向域的DNS。（因为成员机登录需要找DC，DC的地址通过DNS获得）

* 加入这个域的成员机（是电脑，不是账号），如 张三的电脑叫 `xp.qf.com`，会在 DNS 上有你的电脑的 A 记录（即域名会是 `计算机名.qf.com`）。（计算机名不一定以使用者的名称来命名，因为计算机可以给别人用）

**FAQ** 常见问题

Q：那域怎么实现集中管理？

A：部署域控制器的时候，安装了一个最重要的东西，一张表 ， 它叫   **活动目录**，AD(Active Directory)

Q: 活动目录是什么？

A：它放着整个公司的所有公共资源，称作**域资源**。比如说：我在这个活动目录里面建一个账号，称为**域账号**，这个账号 是公司的统一资源。（平时创建的叫本地账户）

Q：那域究竟怎么实现集中管理？

A：问得好，就是靠域账号管理的。比如说，成员机有本地账号，但是域账号不是成员机的本地账号。我可以用域账号登陆这台成员机。并且，这台电脑不会提示账号错误。为什么？因为这台电脑在域环境！当我用域账号登陆的时候，电脑就会找DNS（前面说的必须指向域里的DNS）解析老大（DC）的IP，跟老大说有人要登我（域账号，送给DC）了，老大就去AD（活动目录）找找有没有这个域账号，有的话，就跟成员机说登吧。所以，域账号可以登所有成员机。

### 2.2 GPO，组策略

* GPO：group policy，组策略。
* 作用：一般公司不允许登本地账号，要登域账号，这就要为所有员工建立一个域账号。那这么多域账号，就要分组了（比如：老板一个组，n个部门n个组 这样分）。分组了，这时候组策略就启用了，比如：老板希望 员工每天开机的电脑背景就是他。这就要在 组策略里面新建一张表，然后表里一条策略是“强制背景桌面的”，然后把这个组策略应用到所有部门。那员工每天用域账号登陆，成员机就问老大有人等我了 ... （和上面讲的一样）.... DC跟成员机说登吧。然后，登上去之后，成员机一看是域账号诶，我得问老大还有没有什么要求，然后老大就去活动目录去找，看看这个域账号所在哪个部门，DC一看这个部门贴着一张表（这张表写着要求是老板的头像），DC就会把这张表下发给成员机，成员机就读这张表，看到要我干什么事情，这张表告诉你图片在DC服务器，把它当背景。然后成员机就偷偷到DC下载图片下来，然后设置背景。员工一登陆电脑，就发现背景变了。

### 2.3 小结

1. 活动目录是域的核心，所以也叫AD域。
2. 成员机做什么都要问老大。
3. 安装域控制器 ---- 就生成了域环境
4. 安装了活动目录 --- 就生成了域控制器
5. 活动目录，Active Directory = AD
6. 成员机 加入域后，在 DC 上有它的 DNS A记录，ping 它的名字 相当于 Ping 名字.xxx.com
   同时，也会把 域用户组 加到 本地的 用户组 里