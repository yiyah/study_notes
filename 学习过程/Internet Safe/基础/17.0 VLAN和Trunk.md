# VLAN

[TOC]

## 一、vlan (Virtual LAN 虚拟局域网)

1. 广播/广播域
2. 广播的危害
  增加网络/终端负担，传播病毒，安全性降低
3. 如何控制广播域?
    * 控制广播域 = 隔离广播域
    * 路由器隔离广播（物理隔离广播）
    缺点：成本高、不灵活
4. 采用 VLAN 技术来控制广播

   VLAN 技术是在交换机上实现的且是通过逻辑隔离划分的广播域
5. VLAN 是干什么的
  控制广播域，逻辑隔离广播域
6. Vlan 的类型
    1. 静态 VLAN
        * 手工配置
        * 基于端口划分的 VLAN
    2. 动态 VLAN
        * 手工配置
        * 基于 MAC 地址划分的 VLAN / 采用 802.1x 端口认证 / 基于账号划分 VLAN
7. 静态 VLAN 命令：
    1. 创建 VLAN

        ```CMD
        conf t
        vlan ID,ID, ID-ID # like: vlan 10
        name 自定义名称 # 作用是过久了，自己都忘记这个端口绑定的是哪个部门
        exit
        ```

    2. 查看 VLAN 表

        ```cmd
        show vlan brief
        ```

    3. 将端口加入到 VLAN

        ```CMD
        int f0/x
        switchport access vlan ID
        exit
        ```

### 过程

* 就是在交换机上多了一张 VLAN 表，交换机收到帧后，不再是以前说的先学习你的源 MAC 地址，而是看你从哪个端口进来，数据的帧写着要转发的 MAC 地址，交换机对着 VLAN 表查找，这个 目的MAC地址 和数据进来的这个端口是不是同一个虚拟局域网，是的话才转发数据，否则就丢掉。
* 上面的是单个交换机，要是两台交换机连在一起，每个交换机都连着主机。而想要实现 `连着交换机1` 的 `主机1` 和 `连着交换机2` 的 `主机2` 组成局域网，可以吗？首先要做的就是在两台交换机上为要组成局域网的主机连着的端口配置相同的 VLAN ID。这样就可以了吗？答案是不能，为什么？因为交换机相连的端口并没有配置相同的 VLAN ID，导致了 `主机1` 的数据经过 `交换机1` 的时候就被干掉了（因为 VALN 表上 `主机1` 连着的端口和 两台交换机相连的端口并不是同一个VLAN ID）。OK，此时的你可能会说那我也配置出口的 VLAN ID 一样不就行了吗？没错，是可以。但是当两边交换机的主机有很多都需要组局域网的时候怎么办？一条一条线拉吗？这不可取！所以需要用下面介绍的 Trunk 技术。

## Trunk 技术

### 原理

Trunk 技术就是①把连接交换机的两个端口定义为公共端口，就是不管哪个 VLAN ID 都可以通过这个端口。②交换机收到数据帧的时候从中间插入 **标记** ，为了区分这个数据帧是从哪个局域网发出来的。当这个帧通过公共链路到第二台交换机的时候，第二台交换机提取帧的标记，并且重组帧成正常格式。就可以根据标记转发到对应的局域网。

* Trunk 解决的问题是：**跨交换机相同 VLAN 通信**

1. trunk/中继链路/公共链路
作用：允许所有VLAN数据通过trunk链路
方法：通过在数据帧上加标签，来区分不同的vlan的数据

2. trunk标签：
1）ISL标签：cisco私有的，标签大小30字节26+4
2）802.1q标签：公有协议，所有厂家都支持，标签大小4字节。属于内部标签。

3. 交换机端口链路类型：
1）接入端口：也称为access端口，一般用于连接pc，只能属于某1个vlan,也只能传输1个vlan的数据
2）中继端口：也称为trunk端口,一般用于连接其他交换机，属于公共端口，允许所有vlan的数据通过！

4. 配置trunk命令：

    ```shell
    int f0/x
    switchport trunk encapsulation dot1q/isl # 配置标签的类型 dot1q是国际标准，IS1是思科的
    switchport mode trunk # 选择某个端口配置成 trunk 后，该端口也不在 VLAN 表上显示了。因为 trunk口 是公共的。如果想变回正常的 把 trunk 改回 access
    exit
    ```

四：交换机的工作原理（配置了vlan和trunk后）：
分析：
