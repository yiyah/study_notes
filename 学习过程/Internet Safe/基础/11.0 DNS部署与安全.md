# DNS 部署与安全

[toc]

## 一、DNS

* Domain Name Service 域名服务
* 作用：为客户机提供域名解析服务器

## 二、域名组成

### 2.1 域名组成概述

![看不到图片时科学问题](https://raw.githubusercontent.com/yiyah/Picture_Material/master/image-20200305022012727.png)

### 2.2 域名组成

树形结构

![看不到图片时科学问题](https://raw.githubusercontent.com/yiyah/Picture_Material/master/yuming.png)

根域    .

顶级域

* 国家顶级域 cn jp hk uk
* 商业顶级域 com（商业机构） gov（政府） mil（军事） edu（教育） org（民间组织） net（互联网）

一级域名

二级域名

...

```txt
如：www.baidu.com.
.为根域
.com为顶级域
baidu为一级域名
www为主机名
```

```txt
FQDN = 主机名.DNS后缀 // FQDN(完整合格的域名)
```

## 三、监听端口

```txt
TCP53
UDP53
```

## 四、DNS 解析种类

### 4.1 按查询种类方式分类

1. 递归查询：客户机与本地DNS服务器之间。(简单来说就是所答即所问，一般是客户机问服务器)
2. 迭代查询：本地DNS服务器与根等其他DNS服务器的解析过程。(简单来说就是所答非所问，要指条明路，一般是DNS服务器之间的解析过程)

![看不到图片时科学问题](https://raw.githubusercontent.com/yiyah/Picture_Material/master/image-20200305024606335.png)

### 4.2 按查询内容分类

1. 正向解析：已知域名，解析 IP 地址。
2. 反向解析：已知 IP 地址，解析域名。

## 五、DNS服务器搭建过程

1. 要求网卡IP是静态P地址
2. 安装DNS服务器插件（也就是安装并开启TCP及∪DP53端口）
3. 创建区域文件（负责一个域名后缀的解析，如baidu.com为域名后缀，一台DNS服务器内可存放多个区域文件）
4. 新建A记录

## 六、DNS 客户机如何解析

```cmd
nslookup 域名
```

## 七、DNS 服务器处理域名请求的顺序

1. DNS高速缓存（必须学会如何查看及清空）
2. DNS区域配置文件
3. DNS转发器
4. 根提示

## 八、辅助DNS服务器

## 九、清除 DNS 缓存

9.1 客户机上清除缓存

```cmd
ipconfig /flushdns
```

9.2 服务器上清除缓存

```txt
windows 服务器：dns 工具 --- 查看 --- 高级，调出缓存来，然后右键清除缓存
```

## 十、域名解析记录类型

1. A记录：正向解析记录

2. CNAME记录：别名（不是给IP起别名，而是给已有的域名起别名）

3. PTR记录：反向解析记录

4. MX：邮件交换记录

5. NS：域名服务器解析（就是可以通过这个服务器解析到IP地址的都是NS，但是只有一个是权威服务器叫SOA）

## 十一、反向DNS

nslookup手工解析时，会进行一个反向解析（就是先问这个 DNS服务器叫什么名字，然后才问我要解析的域名是什么地址）

## 十二、DNS 服务器分类

1. 主要名称服务器
2. 辅助名称服务器
3. 根名称服务器
4. 高速缓存名称服务器（就是服务器刚装好 DNS 软件的时候，没有区域文件。找我解析，我就找根）

## 十三、客户机域名请求解析顺序

1. DNS缓存
2. 本地 hosts文件
3. 找本地DNS服务器

## 十四、服务器对域名请求的处理顺序

1. DNS高速缓存
2. 本地区域解析文件（即是不是自己负责这个域名的解析）
3. 转发器（即 DNS服务器 指向的另一个 DNS 服务器）
4. 根

## something to know

1. 什么是本地 DNS 服务器？

    就是客户机指向的那个。

2. 作为 DNS 服务器 必须要知道 根服务器 的地址。
3. 转发器的过程就是 递归解析
    * 递归查询：客户机与本地 DNS 服务器，转发器
    * 迭代查询：DNS 服务器 与 根 之间
4. 如果装了 DNS 服务，但没有配置一些解析域名的配置，单单靠访问根来记录。这叫缓存服务器
