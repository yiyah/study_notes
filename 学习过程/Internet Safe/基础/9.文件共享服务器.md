# 文件共享服务器

* 协议是 cifs（cifs 是window的。区别于ftp，ftp 是全球的；**一般对内用 cifs 服务器，对外用 ftp 服务器**）
* 服务端口是：445

[toc]

## 一、共享服务器概述

通过 网络 提供文件共享服务，提供文件下载和上传服务（类似于FTP服务器）

## 二、创建共享

* 方法：文件夹右键属性 --- 共享 --- 开启共享 --- 设置共享名 --- 设置共享权限

> 注意：
>
> 1）在本地登录时，只受 NTFS 权限的影响
>
> 2）在远程登录时，将受共享及 NTFS 权限的共同影响，且取交集！
>
> 3）所以建议设置共享权限为 everyone 完全控制，然后具体的权限需求在 NTFS 权限中设置即可。

## 三、访问共享

```cmd
1.知识：\ 代表本地路径；\\ 代表网络路径
2.方法：在开始运行或我的电脑地址栏中，输入 UNC 地址(即 `\\x.x.x.x`，如以下两种)：
\\文件共享服务器 IP
\\文件共享服务器\共享名
```

## 四、创建隐藏的共享

* 方法：在创建共享的时候，共享名后加一个 `$`

## 五、访问隐藏共享的方法

* 方法：`\\x.x.x.x\共享名$`

## 六、共享相关命令

```cmd
net share               # 列出共享列表
net share 共享名 /del   # 删除共享
```

## 七、屏蔽系统隐藏共享自动产生

### 7.1 打开注册表 regedit

### 7.2 定位共享注册表位置

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\lanmanserver\parameters

右键新建 REG_DWORD 类型的 AutoShareServer 键，值为 0

## 八、查看本地网络连接状态（开放端口）

netstat -an

## 九、关闭 445 服务

可以通过关闭 445 端口来屏蔽病毒侵入（如勒索病毒）。

* 方法 1 ：打开 services.msc，并停止及禁用名称为 server 的服务（恢复选项卡也得设置一下）
* 方法 2：禁止被访问 445 ，配置高级安全防火墙 - 入站规则（win7及以上系统，win2008 及以上系统）（注意：新建规则的时候，一般的服务要么是TCP要么是UDP，唯独这个 445 两个都有，所以要建两次阻止445！）

## 小结

因为这个文件共享服务啊，重装后就肯定会有几个隐藏共享 `c$` `IPC$`，所以就是说 445 端口肯定打开的。我们可以通过这个端口来进行爆破。（但是如果目标主机没有手动共享任何东西，即只是有默认共享，输入正确的账号密码也是登不进去的，可能只能通过抓取返回的信息来判断有没有验证成功）
