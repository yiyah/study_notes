# IIS 服务器

---

```shell
TCP 80 # HTTP 协议端口
TCP 443 # HTTPS 协议端口
TCP 20/21 # FTP
```

---

[toc]

## 零、环境

* Server 2003x64

## 一、概述

WEB 服务器和 FTP 服务器

1. WEB服务器也称为网页服务器或HTTP服务器（因为WEB服务器使用的协议是 HTTP 或 HTTPS）
2. WEB服务器发布软件

     * 微软：IIS（可以发布Web网站和FTP站点）（Internet Information Services）
     * Linux: Apache /LAMP/Tomcat/nginx  .etc
     * 第三方：phpstudy、XAMPP

## 二、部署 IIS 服务器之 Web 服务

### ！注意：这是静态网页的部署(.html)

### step 1：安装软件

步骤：插入 2003 系统镜像，打开光驱安装应用 --- 选择【安装可选的 Windows 组件】 --- 找到组件下的【应用程序服务器】并双击 --- 找到 【Internet 信息服务】并双击 --- 找到 【万维网服务】勾选--- 然后确定下一步

* 安装了软件就是安装了服务，就是打开了 80 端口

* 安装了软件就已经发布了一个默认站点。这时候如果在相同局域网的客户机的浏览器上输入服务器的地址，会默认显示一个自带的网页（默认网站）。

* 默认站点

    路径：`c:\Inetpub\wwwroot`（右键该站点---属性---主目录---本地路径，可以查看该站点的位置）

    注意：**一般不删除默认网站**，停止就好了。因为可能有些服务依赖默认网站

* **当最后一个网站被停止的时候，端口也被关闭了**。

### step 2：打开软件

步骤：打开 开始菜单 --- 所有程序 --- 管理工具 --- Internet信息服务（IIS）管理器

### step 3：新建网站

* 这个是在禁用默认网站的前提下 ，如果想要发布多个网站请看问题3

步骤：在服务器名字下面，右键【网站】--- 【新建】---【网站】--- 【描述就是该网站在左边显示的名字】---【网站IP地址】就是别人用哪个IP访问你的网站---【路径】填写你写的网页所在的路径，【允许匿名访问】要勾选---【权限】看需要，静态的话默认---完成

* 网站IP地址：一般来说，如果服务器有多张网卡，那就有多个IP，所以才有这个填写。全部未分配就是，通过哪个IP都可以。

* 此网站的主机头：这是给每个网站配置不同的域名时候用的。可以写www.网站名称. 域名后缀（例如：www.hello.com，hello是网站名称，.com是域名后缀）（如果在DNS里已经配置好了域名解析和添加了主机，可以直接填进去）

### step 4: 设置默认文档（默认主页）

步骤：对着网站右键（注意是你要访问的网站的名字，不是服务器名字下的网站文件夹）---【属性】---【文档】--- 添加网页的文件名字（如果网站有多个网页就要排序，先显示位于上面的）

---

### ！注意：这是动态网页的部署（.asp）

```txt
补充说明：
静态网页的一些基础配置和静态网页是相同的，唯一不同的是：
step3:【网站访问权限】需要勾选：一、读取。二、运行脚本（如：ASP）。三、执行（如ISAPI应用程序或CGI）
```

### step 1: 开启 ASP 拓展

步骤：IIS内，点击Web服务扩展 --- 右面看到【Active Server Pages】---  右键允许

### step 2:  开启登陆后台

* 说明： 一般网页都会有一个后台登录界面，这个界面在服务器上 是在整个网站的目录 的子目录里，一般命名：Admin,admin（这两个都是文件夹）；然后该目录下会有一个 admin_login.asp 文件（名字可能会不同），这个就是后台登陆界面了。
* 步骤：IIS内，右键网站名称 --- 属性 --- 【主目录】--- 【配置】--- 【选项】---  勾选【启用父路径】
* 访问：客户机地址栏填写：域名/admin/login.asp 就可以登陆了。（大概就是这样，访问域名下的admin文件夹的login文件）

## 三、部署 IIS 服务器之 FTP 服务

* 与 Web 可以匿名访问 不同的是，FTP 一般不允许匿名访问，不同用户不同权限
* FTP：File Transfer Protocol
* 端口号： TCP 20/21
* 工作方式：（另外一篇笔记讲解这两种方式的区别）
    1. 主动模式
    2. 被动模式

### step1：安装软件

步骤：插入 2003 系统镜像，打开光驱安装应用 --- 选择【安装可选的 Windows 组件】 --- 找到组件下的【应用程序服务器】并双击 --- 找到 【Internet 信息服务】并双击 --- 找到 【文件传输协议（FTP）服务】勾选--- 然后确定下一步

* 安装了软件就是安装了服务，就是打开了 TCP 20/21 端口

* 安装了软件就已经 是一个FTP服务器了。这时候如果在相同局域网的客户机的文件资源管理器的地址栏中输入：
    `ftp://服务器地址`（如：<ftp://10.1.1.1>）就可以访问了，不过默认站点什么都没有。

* 默认站点

    路径：`c:\Inetpub\ftproot`（右键该站点---属性---主目录---本地路径，可以查看该站点的位置）

    注意：FTP的默认站点可以删除，web的不可以。因为FTP一般也用不着。

    使用： 往该站点目录存放东西，客户机就可以下载了。

### step2：打开软件

### step3：新建站点

步骤：右键【FTP站点】--- 新建 --- FTP站点，下一步--- 【描述】就是该站点在左边显示的名字 --- 【IP和端口设置】IP填写服务器的地址，端口默认（FTP一般不用域名访问，所以没有主机头的设置）--- （默认）下一步到【路径】填写该站点的本地路径 --- 【权限】按需 --- 下一步完成

* 权限：FTP权限和NTFS权限取交集，可以对比之前的网络共享设置的权限，也是取交集。一般读写、写入都会勾上，然后在设置NTFS权限。

### step4：配置权限

* 目的：当你的FTP服务器需要给别人使用，但是又不想把整个服务器的权限（管理员密码）给他。这时候就要新建一个账户，然后为该账户配置NTFS权限。

步骤 ：先停用该站点的匿名访问，右键站点名称【属性】--- 【安全账户】---去掉【允许匿名访问】的勾 --- 【cmd】输入`net user userFTP 123 /add`--- 到该站点的本地路径配置NTFS权限

* 说明：去掉【允许匿名访问】的勾后，别人就不能直接输入服务器地址访问了。下一步就是为别人新建一个专门登陆ftp服务器的账户了
* `net user userFTP 123 /add`：新建账户名：userFTP 密码：123
* 配置NTFS权限详情参考之前的笔记《NTFS 安全权限》，这里说一下常规操作：
    1. 先确保用户 在 本地路径的文件夹 的权限，一般具有“读取和列出”“列出文件夹目录”“读取”
    2. 第一步是确保该用户能够访问该目录。接下来，就要对该目录下的子文件夹设置权限，先取消继承。然后单独添加该用户，再给他设置权限。

### ！注意：用户最终权限为 FTP 权限与 NTFS 权限取交集。（建议FTP权限全选，具体的在NTFS里设置。）

## 四、问题

---

### 4.1 这些问题是WEB服务器问题：(1 - 5)

---

1. 客户机访问网页需要账户密码

    * 这是因为没有启用匿名访问的原因

    * 解决方法：对着网站右键（注意是你要访问的网站的名字，不是服务器名字下的网站文件夹）---【属性】---【目录安全性】--- 【身份验证和访问控制】点击【编辑】---勾上【启用匿名访问】

    * 补充说明：【启用匿名访问】下会有一个账户密码，这个账户密码时安装IIS的时候，他自动新建的匿名账户。作用：客户机访问服务器的时候，服务器偷偷把这个账号密码发给客户机，客户机再假装发给服务器。服务器就说ok，账号密码对了，你访问吧。

2. 客户机访问服务器出现“Directory Listing Denied”或者“您无权查看该网页”

    就是默认列表被拒绝

    * 解决方法：对着网站右键（注意是你要访问的网站的名字，不是服务器名字下的网站文件夹）---【属性】---【文档】--- 添加网页的文件名字（如果网站有多个网页就要排序，先显示位于上面的）
    * 补充说明：【文档】就是告诉别人我这个网站里面谁是首页。用户在访问我的时候，我这个网站有这么多网页，我把哪个网页发给客户呢？这个页面就叫首页，而在文档里面叫做默认文档，目的就是用来指定首页的，这个地方没有指定哪个是首页的话就无法找到。点添加然后输入网页的文件名字就是指定默认文档。

3. 一个服务器怎么发布多个网页？

    如果服务器只有一块网卡，第一个网站新建的时候就会占用了这个IP，新建第二个网站的时候即使也选了这个IP，新建后是显示停止状态。怎么办？

    * **方法一**：给服务器再装一个网卡（实验用）

        步骤：【网络连接】---右键【本地连接】--- 双击【Internet协议】---点击【高级】---【IP设置】下的IP地址，点击【添加】弄个IP地址上去就好了（同一网段）--- 然后右键停止的网站【属性】---选项卡【网站】下IP地址下拉可以看到刚才填写的IP（没有的话重启一下IIS软件），选中确定 ---   右键网站启动。（客户机访问不同的IP就可以访问网站了）

        验证：怎么验证服务器此时已经有两个IP了？`ipconfig` 会看到两个IP地址

    * **方法二**：同一IP，不同端口号（1000+以下都是被预定的，所以用1000+以上的端口号，一般是8080、8000）

        步骤：右键停止的网站【属性】---选项卡【网站】---【TCP端口】填写8000---确定保存。（客户机访问10.1.1.1就是访问80端口，访问第二个网站输入10.1.1.1:8000）

    * **方法三**：IP一样，端口号一样。但两个网站绑定不同的域名（主机名）

        步骤：打开DNS软件，新建一个正向查找区域，新建主机，IP地址是一样的。（参考部署DNS服务器）区域名称就写网站名称如：hello.com、goodbye.com(新建两个，因为是多个网站，就要多个域名，然后去验证）--- 然后右键网站【属性】---选项卡【网站】---【高级】---点击需要绑定的IP地址，点击【编辑】---【主机头值】www.hello.com （其他网站同理）---确定保存

        * 补充说明：【主机头值】当一个请求到我这的时候，光写上IP、端口号还不行，我还要看看你在浏览器输入的主机头值是不是我这个，是的话我才认为绑定组合有效。

    * **总结**：

        方法一是用两个IP，这样很不稳定。（不同IP相同端口号）（测试用）

        方法二同一IP，不同端口号。（测试用）

        方法三同一IP，同一端口号，不同域名（主机头）

        ![方法三教程](https://raw.githubusercontent.com/yiyah/Picture_Material/master/20200407234314.png)

4. 我想要 IP 和域名都能访问我的网页，怎么做？

    * 这样的话，服务器只能是发布一个网站。因为，和一开始一样，想要用IP访问，服务器就必须绑定一个网站，其他新建的网站会停用。所以，只是在用IP访问的基础上加一个域名访问而已。

    * 解决方法：

        ![看不到图片是科学问题](https://raw.githubusercontent.com/yiyah/Picture_Material/master/20200407235155.png)

5. 如果新建网站的时候路径填错了怎么办？

    解决方法：  IIS内，右键网站名称 --- 属性 --- 选项卡【主目录】 --- 【本地路径】修改就好了

---

#### 4.2 以下是 FTP 服务器问题

---

无

## 五、总结

1. 客户机想要访问到IIS服务器，就需要
    * IIS 服务器的网站的 IP 、端口正确、默认文档设置好
    * DNS 服务器的主机 IP正确
    * 启用匿名访问
2. 注意：部署这两种服务器都是要配置静态IP 的！

3. 一堆网页组成一个站点，叫网站
