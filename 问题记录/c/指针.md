# 指针

[TOC]

## 一、数组

### 数组指针

* 数组指针是指向数组地址的指针，其本质为指针；

  * 在说 数组指针 前先说一下 普通指针

    ```c
    char str[] = "01234";
    char *pch = str;  // 常见的初始化，这个是指针变量，和数组指针不同！
    // 使用方式
    printf("%s --- %s\n", str, p);  // 01234 --- 01234
    printf("%c --- %c\n", str[3], p[4]);  // 3 --- 4
    // 普通的指针 指向 数组后，和使用 数组名 访问 数组元素 没有啥区别
    // 指向的是 数组元素
    ```

  * 数组指针

    ```c
    char str[] = "01234";
    char (*ps)[5] = str;  // 这个才是 数组指针 的定义
    // 使用方式
    printf("%s\n", ps);  // 01234
    // 因为数组指针并不是指向 数组元素，所以不能直接 ps[2] 取数组元素
    // 需要先将 ps 转为 列指针，才可访问列元素 *ps
    // *ps[2]: ps 先和 [] 结合，ps[2] 表示指向第三行的地址，再经 `*` 转为列指针，访问的是 第三行、第一列的元素。在此会出错
    printf("%c\n", (*ps)[2]);  // 2
    // 因为，这个 ps 指针相当于指向了一个二维数组，所以，可以通过访问二维数组元素的方法来访问
    printf("%c", ps[0][3]);  // 3
    // 其他访问方法
    printf("%c", *(*(ps+0)+4));  // 4  // *(ps+0) 确定行后转为列指针；*(ps+0)+4 列指针指向第几个元素；*(*(ps+0)+4) 取列指针的内容。
    ```

* 小结

  * 指向数组的 普通指针 指向的是**数组的元素**；数组指针指向的是数组的全部（并不是某个具体的元素），即一行。所以 数组指针 也称指向 一维数组 的指针，亦称**行指针**。
  * 数组指针 只是一个 指针变量，似乎是 C语言 里专门用来指向 二维数组的。
  * 有行指针就有列指针（这个是在 二维数组 体现的）：
    两个重要概念：行指针和列指针。
    **行指针**：指的是一整行，不指向具体元素。
    **列指针**：指的是一行中某个具体元素。
  * 那么两个概念之间的具体转换是：
    `*行指针 --> 列指针`（意思是，在行指针前加上 `*` 就可变为列指针）
    `&列指针 --> 行指针`（意思是，在列指针前加上 `&` 就可变为行指针）
  * 数组指针 理解为 行指针 是最好的（即使它指向一维数组，也可理解为只有一行）。然后每一行的元素，就是 **列元素**。假设 `p` 是行指针，要想访问 列元素，就需要先将行指针变为列指针，然后访问列元素。通过 `*p` 就可把 `p` 转为列指针。
  * 数组指针访问列元素的几种方法：

      1. `p[i][j]`
      2. `(*(p+i))[j]`: `*(p+i)` 表示指向第 i 行后转列元素，最后通过 `[j]` 选择第 j 列。
      3. `*(*(p+i)+j)`: `*(p+i)` 表示指向第 i 行后转列元素，通过 `+j` 选择第 j 列，最后用 `*()` 取内容。
      4. `*(p[i]+j)`: `p[i]` 表示选择第 i 行的第 0 列元素，通过 `+j` 选择第 j 列，最后用 `*()` 取内容。

### 指针数组

* 数组元素全为指针变量的数组称为 指针数组，指针数组中的元素都必须具有相同的存储类型、指向相同数据类型的指针变量。
* **注意**：像 `char str[] = "hello";` 这样的定义，`str` 和 `&str` 的值是一样的。在 指针数组 也是一样的！
  但是 `*str` 这个操作就不一样了！因为，指针数组的元素都是指针。也就是说，在普通数组里 `*str` 就是取内容；在指针数组里，就是取地址！

  * 所以，要访问指针数组的元素的内容，就需要 定义一个 **二级指针** 来访问
  
  ```c
  char *str[] = {"0123", "abcd"};
  char **p = str;
  // p 就相当于 str
  printf("%s --- %s\n", *str, *p);  // 0123 --- 0123
  printf("%s --- %s\n", *(str+1), *(p+1));  // abcd --- abcd
  printf("%c --- %c --- %c\n", **p, *(*p+1), *(*(p+1)+2));  // 0 --- 1 --- c  // %c 给内容，所以 **p；*p+1 取同行不同列元素地址；*(p+1)+2 取不同行不同列地址。
  ```

### 小结 1

1. 数组指针 `char (*p)[5]`: `()` 和 `[]` 同优先级，从左到右结合。`(*p)` 表明这是一个指针；`[]`表明这个是一个指针变量；后面的 `[]` 表明该指针指向数组。所以是数组指针。
2. 指针数组 `char *p[5]`: `[]` 比 `*` 优先级高，`p` 和 `[]` 先结合，表明这是一个数组；`*` 表示数组元素为指针。所以是指针数组。
3. 取 `%s`，给地址；取 `%c` 给内容；

## 二、函数

### 函数指针

* 函数指针是指向函数的指针变量。

函数指针变量的声明：

```c
// 普通函数定义
int add(int x, int y)
{
    return x+y;
}
// 函数指针声明及初始化
int (*p)(int, int) = add; // add 函数名代表了该函数的入口地址。实测换成 &add 也是可以的，可是不明白

int sum = p(5, 6);  // 函数指针的使用
```

### 指针函数

* 首先明确，任何一个函数都有返回类型（如果不返回值，则为无值型）。
* 指针函数是一个函数，只不过指针函数返回类型是一个指针。

```c
// 全局变量
int g_sum = 0;
// 指针函数（返回一个指针，对比普通函数，多了*，和定义指针变量一样也是多了个*，就变成了关于指针的东西）
int *add(int x, int y)
{
    g_sum = x+y;
    return &g_sum;  // 返回地址
}

int *sum = add(1, 2);  // 因为 add() 返回一个指针，所以接收的变量的类型也就需要是一个同类型的指针。
```

### 函数指针与指针函数

```c
// 全局变量
int g_sum = 0;
// 指针函数（返回一个指针，对比普通函数，多了*，和定义指针变量一样也是多了个*，就变成了关于指针的东西）
int *add(int x, int y)
{
    g_sum = x+y;
    return &g_sum;  // 返回地址
}

int *(*p)(int, int) = add;  // 声明一个函数指针，该指针 指向一个返回指针的函数
int *sum = p(4, 5);  // 因为 p指向了一个返回指针的函数，所以接收的变量的类型也就需要是一个同类型的指针。
```

### 小结 2

`int *p(void);` 和 `int (*p)(void);` 的区别

* 指针函数 `int *p(void);`:
  
  1. 后缀运算符括号 `()` 表示这是一个函数。
  2. 其前缀运算符星号 `*` 表示此函数为指针型函数，其函数值为指针，即它带回来的值的类型为指针。
  3. 由于 `*` 的优先级低于 `()` 的优先级，因而 p 首先和后面的 `()` 结合，也就意味着，p 是一个函数。即：`int *(p(void));`
  4. 接着再和前面的 `*` 结合，说明这个函数的返回值是一个指针。由于前面还有一个 `int` ，也就是说，p 是一个返回值为整型指针的函数。

* 函数指针 `int (*p)(void);`：

  1. 前后都有运算符括号 `()`，从左往右执行，`(*p)` 表明该变量是一个指针。
  2. 后面的 `()` 表明该指针指向函数。

## 总结

## 参考

1. [指针函数](https://baike.baidu.com/item/%E6%8C%87%E9%92%88%E5%87%BD%E6%95%B0/2641780)
2. [函数指针](https://www.runoob.com/cprogramming/c-fun-pointer-callback.html)
3. [数组指针和指针数组的区别](https://www.cnblogs.com/hongcha717/archive/2010/10/24/1859780.html)
4. [[cpp] 字符数组,字符指针,sizeof,strlen总结](https://www.cnblogs.com/alex-tech/archive/2011/03/26/1996284.html)
